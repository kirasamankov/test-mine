<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Block Bonus</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>

<style>
html,body{margin:0;height:100%;background:#79d0ff}
canvas{
  image-rendering:pixelated;
  image-rendering:crisp-edges;
  display:block;
  margin:auto;
  border-radius:18px;
}
</style>
</head>

<body>

<script>
const W=360, H=640;
const COLS=5;
const CELL=48;

const TOP_ROWS=3;
const MINE_ROWS=6;

const X0=(W-COLS*CELL)/2;
const TOP_Y=20;
const MINE_Y=TOP_Y+TOP_ROWS*CELL;
const CHEST_Y=MINE_Y+MINE_ROWS*CELL;
const SLAB_Y=CHEST_Y+52;

new Phaser.Game({
  type:Phaser.CANVAS,
  width:W,
  height:H,
  backgroundColor:"#79d0ff",
  pixelArt:true,
  scene:{preload,create}
});

function preload(){
  this.load.image("pick_wood","assets/pick_wood.png");
  this.load.image("pick_iron","assets/pick_iron.png");
  this.load.image("pick_gold","assets/pick_gold.png");
  this.load.image("pick_diamond","assets/pick_diamond.png");
  this.load.image("eye","assets/eye.png");
  this.load.image("book","assets/book.png");
  this.load.image("tnt","assets/tnt.png");

  this.load.image("grass","assets/tile_grass.png");
  this.load.image("dirt","assets/tile_dirt.png");
  this.load.image("iron","assets/tile_iron.png");

  this.load.image("chest","assets/chest_closed.png");
  this.load.image("slab","assets/slab.png");
}

function create(){
  drawTopPanel(this);
  drawMine(this);
  drawChests(this);
  drawSlab(this);
  fillTopWithItems(this);
}

function drawTopPanel(s){
  drawGrid(s,X0,TOP_Y,COLS,TOP_ROWS,0xbfc3c7);
}
function drawMine(s){
  for(let r=0;r<MINE_ROWS;r++){
    for(let c=0;c<COLS;c++){
      let tex="dirt";
      if(r===0) tex="grass";
      if(r===2) tex="iron";
      const img=s.add.image(
        X0+c*CELL+CELL/2,
        MINE_Y+r*CELL+CELL/2,
        tex
      );
      img.setScale(CELL/img.width);
    }
  }
  drawGrid(s,X0,MINE_Y,COLS,MINE_ROWS,null,true);
}
function drawChests(s){
  for(let c=0;c<COLS;c++){
    const img=s.add.image(
      X0+c*CELL+CELL/2,
      CHEST_Y+22,
      "chest"
    );
    img.setScale(44/img.width);
  }
}
function drawSlab(s){
  const img=s.add.image(W/2,SLAB_Y+14,"slab");
  img.setScale(188/img.width);
  s.add.text(W/2,SLAB_Y+16,"0.00",{
    fontFamily:"Press Start 2P",
    fontSize:"14px",
    color:"#fff"
  }).setOrigin(0.5);
}

function drawGrid(s,x,y,cols,rows,fill,black){
  const g=s.add.graphics();
  if(fill!==null){
    g.fillStyle(fill,1);
    g.fillRect(x,y,cols*CELL,rows*CELL);
  }
  g.lineStyle(2,black?0x000000:0xffffff,black?0.35:0.9);
  for(let c=0;c<=cols;c++){
    g.lineBetween(x+c*CELL,y,x+c*CELL,y+rows*CELL);
  }
  for(let r=0;r<=rows;r++){
    g.lineBetween(x,y+r*CELL,x+cols*CELL,y+r*CELL);
  }
}

function fillTopWithItems(s){
  const items=["pick_wood","pick_iron","pick_gold","pick_diamond","eye","book","tnt"];
  for(let i=0;i<15;i++){
    const key=items[Math.floor(Math.random()*items.length)];
    const c=i%COLS;
    const r=Math.floor(i/COLS);
    const img=s.add.image(
      X0+c*CELL+CELL/2,
      TOP_Y+r*CELL+CELL/2,
      key
    );
    img.setScale((CELL-8)/img.width);
  }
}
</script>
</body>
</html>
